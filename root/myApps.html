<style>
    #all-draggable .unsortable a:first-child{
        border: 1px solid #80808026;
    }
    #my-draggable{
        min-height: 120px;
    }
</style>

<div class="my-apps-sec">
        <h5 class="font-weight-bold text-dark edwards-brdr mb-4">My Apps</h5>
        <a href="#" id="add-apps" class="text-primary position-absolute tr-0 mr-3 mt-2"><small>Edit</small></a>

        <p class="apps-not-found" style="padding: 25px 0 30px 0; color: gray; display: none;">You have not selected any apps yet!</p>

        <div class="hrzntl-tb-cntrl aps-crsl position-relative">
            <div class="external apps-external-div px-3" id="content">
                <ul class="scroll-container nav nav-pills" id="my-apps-ul" role="tablist">
                    
                </ul>
                </div>
            <a class="carousel-control-prev" href="javascript:void(0)" id="apps-left-btn">
                <i class="fa fa-chevron-left fa-lg text-muted"></i>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="javascript:void(0)" id="apps-right-btn">
                <i class="fa fa-chevron-right fa-lg text-muted"></i>
                <span class="sr-only">Previous</span>
            </a>
        </div>
    </div>

    <!-- end my apps  -->


    <div class="my-shrtcts-sec position-relative">
            <h5 class="font-weight-bold text-dark edwards-brdr mb-4">My Shortcuts</h5>
            <a href="#" id="edit-myLinks-btn" class="text-primary position-absolute tr-0 mr-0 mt-2"><small>Edit</small></a>
            
                <div class="shrct-tbs">
                    <ul class="nav nav-pills justify-content-center" id="pills-shrtct-tab" role="tablist">
                        <li class="active nav-item">
                            <a class="nav-link active" href="#qcklnks" id="pills-qcklnks-tab" data-toggle="pill"  role="tab" aria-controls="pills-qcklnks-tab" aria-selected="true"><i class="far fa-dot-circle"></i> Quick Links</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="pills-rmnder-tab" href="#rmnder" data-toggle="pill"  role="tab" aria-controls="pills-rmnder-tab"><i class="far fa-dot-circle"></i> Reminders</a>
                        </li>
                    </ul>
                </div>
                <div class="tab-content" id="pills-shrtct-tab-content">
                  <div class="tab-pane fade show active" id="qcklnks" role="tabpanel" aria-labelledby="pills-qcklnks-tab">
                      <div class="row">
                          <div class="col-sm-6">
                              <ul class="list-group list-group-flush flsh-lst-itm">
                                  
                             </ul>
                          </div>
                          <div class="col-sm-6">
                              <ul class="list-group list-group-flush flsh-lst-itm">
                                 
                             </ul>
                          </div>
                      </div>

                    </div>

                  <div class="tab-pane fade" id="rmnder" role="tabpanel" aria-labelledby="pills-rmnder-tab">
                   <ul class="list-group list-group-flush flsh-lst-itm">
                      <li class="list-group-item"><a href="#" class="text-black-50 "><small class="d-block float-left"><i class="fas fa-link "></i></small> <small class="d-block pl-4">Link to a site page with extra space</small></a></li>
                      <li class="list-group-item"><a href="#" class="text-black-50 "><small class="d-block float-left"><i class="fas fa-link "></i></small> <small class="d-block pl-4">Link to a coumentspace</small></a></li>
                      <li class="list-group-item"><a href="#" class="text-black-50 "><small class="d-block float-left"><i class="fas fa-link "></i></small> <small class="d-block pl-4">Link to a site page </small></a></li>
                      <li class="list-group-item"><a href="#" class="text-black-50 "><small class="d-block float-left"><i class="fas fa-link "></i></small> <small class="d-block pl-4">Link to a site page </small></a></li>
                    </ul>
                </div>
            </div>
        </div>

                <div class="modal fade edwards-modal-popup" id="my-links-modal" role="dialog" style="display: none;" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <ul class="nav nav-tabs">
                                        <li><a data-toggle="tab" href="#myApps-popuptab1" class="active">Customize My Apps</a></li>
                                        <li><a data-toggle="tab" href="#myLinks-popuptab2">Customize My Links</a></li>
                                    </ul>
                                    <button type="button" class="close" data-dismiss="modal">Ã—</button>
                                </div>
                                <div class="modal-body p-3 p-sm-4">
                                    <div class="tab-content">
                                        <div id="myApps-popuptab1" class="tab-pane fade in active popuptab1">
                                            <p class="text-black-50 mb-4 text-center">Drag and drop apps to be shown here. You can add upto 12 apps</p>
                                            <ul class="clearfix edwards-drag-section row p-0" id="my-draggable">
                                                
                                            </ul>
                                            <div class="srch-area w-100 border border-dark-50 mx-auto mb-3" style="max-width:400px;">
                                              <label class="sr-only" for="inlineFormInputGroup">Search</label>
                                              <div class="input-group input-group-sm">
                                                <div class="input-group-prepend">
                                                  <div class="input-group-text p-0"><button type="button" class="btn btn-outline-danger btn-sm"><i class="fas fa-search"></i></button></div>
                                                </div>
                                                <input type="text" class="form-control" id="popupsrch" placeholder="Search App">
                                              </div>
                                            </div>
                                            <div class="edwards-popup-sub-tabs">
                                                <ul class="nav nav-pills justify-content-center mb-4 nav-fill">
                                                </ul>
                                                <div class="tab-content">
                                                    <div id="subtab1" class="tab-pane fade in active">
                                                        <ul class="clearfix row flex-sm-row flex-column p-0 apps-lst edwards-drag-section" id="all-draggable">
                                                            
                                                        </ul>
                                                    </div>
                                                    
                                                    
                                                </div>
                                            </div>
                                        </div>
                                        <div id="myLinks-popuptab2" class="tab-pane fade">
                                            <p class="mb-4 text-black-50 text-center"></p>
                                            <div class="row">
                                                <div class="col-sm-6 mb-4">
                                                    <div class="bg-light p-3">
                                                        <div class="form-group">
                                                        <label for="lnk1">Link 1</label>
                                                        <input type="text" class="form-control rounded-0 mb-2 form-control-sm" id="lnk1-input1" placeholder="">
                                                        <input type="text" class="form-control rounded-0 mb-2 form-control-sm" id="lnk1-input2" placeholder="">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-6 mb-4">
                                                    <div class="bg-light p-3">
                                                        <div class="form-group">
                                                        <label for="lnk2">Link 2</label>
                                                        <input type="text" class="form-control rounded-0 mb-2 form-control-sm" id="lnk2-input1" placeholder="">
                                                        <input type="text" class="form-control rounded-0 mb-2 form-control-sm" id="lnk2-input2" placeholder="">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-6 mb-4">
                                                    <div class="bg-light p-3">
                                                        <div class="form-group">
                                                        <label for="lnk3">Link 3</label>
                                                        <input type="text" class="form-control rounded-0 mb-2 form-control-sm" id="lnk3-input1" placeholder="">
                                                        <input type="text" class="form-control rounded-0 mb-2 form-control-sm" id="lnk3-input2" placeholder="">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-6 mb-4">
                                                    <div class="bg-light p-3">
                                                        <div class="form-group">
                                                        <label for="lnk4">Link 4</label>
                                                        <input type="text" class="form-control rounded-0 mb-2 form-control-sm" id="lnk4-input1" placeholder="">
                                                        <input type="text" class="form-control rounded-0 mb-2 form-control-sm" id="lnk4-input2" placeholder="">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-6 mb-4">
                                                    <div class="bg-light p-3">
                                                        <div class="form-group">
                                                        <label for="lnk5">Link 5</label>
                                                        <input type="text" class="form-control rounded-0 mb-2 form-control-sm" id="lnk5-input1" placeholder="">
                                                        <input type="text" class="form-control rounded-0 mb-2 form-control-sm" id="lnk5-input2" placeholder="">
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-sm-6 mb-4">
                                                    <div class="bg-light p-3">
                                                        <div class="form-group">
                                                        <label for="lnk6">Link 6</label>
                                                        <input type="text" class="form-control rounded-0 mb-2 form-control-sm" id="lnk6-input1" placeholder="">
                                                        <input type="text" class="form-control rounded-0 mb-2 form-control-sm" id="lnk6-input2" placeholder="">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary rounded-0 px-4" data-dismiss="modal">Cancel</button>
                                    <button type="button" id="myLinks-save-btn" class="btn btn-danger rounded-0 px-4">Save</button>
                                    <button type="button" id="myApps-save-btn" class="btn btn-danger rounded-0 px-4">Save</button>

                                </div>
                            </div>
                        </div>
                    </div>


             
             <script type="text/javascript">
	
                /*===  variables ===*/
                var myLinks = {
                    clientContext: null,
                    oList: null,
                    editMode: false,
                    responseMsg: '',
                    items: [6]
                };
                /*===  variables ===*/	

                $( document ).ready(function() {
                    SP.SOD.executeFunc('sp.js', 'SP.ClientContext', function(){
                        myLinks.retrieveListItems();
                    }) 
                }) ;
                 
                 /*=== open modal and select my-links tab ===*/
                 $("#edit-myLinks-btn").click(function() {
                    $('#myApps-save-btn').hide();
                    $('#myLinks-save-btn').show();
                    $('#my-links-modal').modal('show');
                    $('.nav-tabs a[href="#myLinks-popuptab2"]').tab('show');
                    $('#myLinks-popuptab2 div.col-sm-6').each(function(i, obj) {
                        $(this).find('input[type="text"]:first').val('');
                        $(this).find('input[type="text"]:last').val('');
                    });
                    myLinks.loadFormData();
                 });
                 /*=== open modal and select my-links tab ===*/
                 
                 /*=== when modal save btn is clicked ===*/
                 $("#myLinks-save-btn").click(function() {
                    var tempUpdateItems = [], tempCreateItems = [], errMsg = '';		
                    $('#myLinks-popuptab2 div.col-sm-6').each(function(i, obj) {
                            var title = $(this).find('input[type="text"]:first').val();
                            var url = $(this).find('input[type="text"]:last').val();
                            if(myLinks.items[i]){
                                //update
                                if(!title || !url){
                                    errMsg += "Title or URL in Link " + (i+1) + " cannot be empty!\n";
                                }
                                if(!myLinks.validateUrl(url))
                                    errMsg += "URL in Link " + (i+1) + " must start with http(s)://\n";
                                if(myLinks.items[i].title != title || myLinks.items[i].url != url){
                                    myLinks.items[i].title = title;
                                    myLinks.items[i].url = url;
                                    //myLinks.updateListItem(myLinks.items[i]);
                                    tempUpdateItems.push(myLinks.items[i]);
                                }
                            }
                            else if(title || url){
                                //create
                                if(!title || !url){
                                    errMsg += "Title or URL in Link " + (i+1) + " cannot be empty!\n";
                                }
                                else if(url && !myLinks.validateUrl(url))
                                    errMsg += "URL in Link " + (i+1) + " must start with http(s)://\n";
                                else{
                                    var obj = {
                                        title: title,
                                        url: url,
                                        order: (i+1)
                                    }
                                    tempCreateItems.push(obj);
                                }
                                    
                            }			
                    });
                    
                    if(errMsg){
                        alert(errMsg);
                        return;
                    }
                    if(tempUpdateItems.length)
                        myLinks.updateMultipleListItems(tempUpdateItems);
                        
                    if(tempCreateItems.length)
                        myLinks.createMultipleListItems(tempCreateItems);
                 });
                /*=== when modal save btn is clicked ===*/	
                
                /*===  helper functions ===*/
                myLinks.validateUrl = function(url){
                    var urlPattern = new RegExp('^https?:\/\/.*$');
                    return urlPattern.test(url);
                }
                
                myLinks.onQueryFailed = function(sender, args) {
                    debugger;
                    var customMsg = this.errorMsg? this.errorMsg : '';
                    alert(customMsg + args.get_message() + '\n' + args.get_stackTrace());
                }
                /*===  helper functions ===*/
                
                
                
                myLinks.retrieveListItems = function() {
                    myLinks.clientContext = new SP.ClientContext();
                    myLinks.oList = myLinks.clientContext.get_web().get_lists().getByTitle('Important Links');
                    var camlQuery = new SP.CamlQuery();
                    var q = '<View><Query><Where><Eq><FieldRef Name="Author" LookupId="TRUE" /><Value Type="Integer"><UserID /></Value></Eq></Where></Query></View>';
                    camlQuery.set_viewXml(q);
                    myLinks.collListItem = myLinks.oList.getItems(camlQuery);
                    myLinks.clientContext.load(myLinks.collListItem);
                    this.errorMsg = "Get list items request failed! "; //this is available in success/error functions called below;
                    myLinks.clientContext.executeQueryAsync(Function.createDelegate(this, myLinks.onQuerySucceeded), Function.createDelegate(this, myLinks.onQueryFailed));        
                }
                
                myLinks.onQuerySucceeded = function(sender, args) {
                    myLinks.items = [];
                    myLinks.items.length = 6;
                    var listItemEnumerator = myLinks.collListItem.getEnumerator();	
                    while (listItemEnumerator.moveNext()) {
                        var oListItem = listItemEnumerator.get_current();
                        var item = {
                            id: oListItem.get_item('ID'),
                            title: oListItem.get_item('Title'),
                            url: oListItem.get_item('URL').$1_1,
                            order: oListItem.get_item('Order0')
                            };
                        if(item.order >=1 && item.order <=6 && !myLinks.items[item.order - 1])
                            myLinks.items[item.order - 1] = item;
                    }
                    //render data
                    var col1 = '', col2 = '', linkHtml = '';
                    for(var i = 0; i < myLinks.items.length; i++){

                        var link = myLinks.items[i];
                        if(link)
                            linkHtml = '<li class="list-group-item">'+
                                        '	<a href="'+ link.url +'" class="text-black-50 ">'+
                                        '		<small class="d-block float-left"><i class="fas fa-link "></i></small> '+
                                        '		<small class="d-block pl-4">'+ link.title +'</small>'+
                                        '	</a>'+
                                        '</li>';
                        if(i < 3){
                            col1 += linkHtml;
                        }
                        else if(i < 6){
                            col2 += linkHtml;
                        }
                    }
                    if(col1){
                        $('#qcklnks .col-sm-6:first-child ul').empty();
                        $('#qcklnks .col-sm-6:first-child ul').append(col1); 
                    }
                    if(col2){
                        $('#qcklnks .col-sm-6:last-child ul').empty();
                        $('#qcklnks .col-sm-6:last-child ul').append(col2); 
                    }
                    
                }

                myLinks.loadFormData = function(){
                    if(myLinks.items){
                        $('#myLinks-popuptab2 div.col-sm-6').each(function(i, obj) {
                            if(myLinks.items[i]){
                                $(this).find('input[type="text"]:first').val(myLinks.items[i].title);
                                $(this).find('input[type="text"]:last').val(myLinks.items[i].url);
                            }	
                        });
                    }
                }
                
                //create single item.
                myLinks.createListItem = function(title, url, order){
                    var itemCreateInfo = new SP.ListItemCreationInformation();
                    myLinks.oListItem = myLinks.oList.addItem(itemCreateInfo);
                    myLinks.oListItem.set_item('Title', title);
                    myLinks.oListItem.set_item('URL', url);
                    myLinks.oListItem.set_item('Order0', order);
                    myLinks.oListItem.update();
                    myLinks.clientContext.load(myLinks.oListItem);
                    this.errorMsg = "Create list item Request failed. ";
                    myLinks.clientContext.executeQueryAsync(Function.createDelegate(this, myLinks.onCreateQuerySucceeded), Function.createDelegate(this, myLinks.onQueryFailed));
                }
                
                //create multiple items.
                myLinks.createMultipleListItems = function(items){
                    for(var i=0; i<items.length; i++){
                        var item = items[i];
                        var itemCreateInfo = new SP.ListItemCreationInformation();
                        myLinks.oListItem = myLinks.oList.addItem(itemCreateInfo);
                        myLinks.oListItem.set_item('Title', item.title);
                        myLinks.oListItem.set_item('URL', item.url);
                        myLinks.oListItem.set_item('Order0', item.order);
                        myLinks.oListItem.update();
                        myLinks.clientContext.load(myLinks.oListItem);
                        this.errorMsg = "Create list item Request failed. ";
                    }
                    myLinks.clientContext.executeQueryAsync(Function.createDelegate(this, myLinks.onCreateQuerySucceeded), Function.createDelegate(this, myLinks.onQueryFailed));
            
                }
                
                 myLinks.onCreateQuerySucceeded = function(sender, args) {
                    $('#my-links-modal').modal('hide');
                    //alert('item(s) created successfully!');
                    //myLinks.resetForm();
                    //myLinks.retrieveListItems();
                }
                
                //create single list item.
                myLinks.updateListItem = function(item){
                    myLinks.oListItem = myLinks.oList.getItemById(item.id);
                    myLinks.oListItem.set_item('Title', item.title);
                    myLinks.oListItem.set_item('URL', item.url);
                    myLinks.oListItem.update();
                    this.errorMsg = "Update list item Request failed. ";
                    myLinks.clientContext.executeQueryAsync(Function.createDelegate(this, myLinks.onUpdateQuerySucceeded), Function.createDelegate(this, myLinks.onQueryFailed));
                }
                
                //update multiple list items.
                myLinks.updateMultipleListItems = function(items){
                    for(var i=0; i<items.length; i++){
                        var item = items[i];
                        myLinks.oListItem = myLinks.oList.getItemById(item.id);
                        myLinks.oListItem.set_item('Title', item.title);
                        myLinks.oListItem.set_item('URL', item.url);
                        myLinks.oListItem.update();
                        this.errorMsg = "Update list item Request failed. ";
                    }
                    myLinks.clientContext.executeQueryAsync(Function.createDelegate(this, myLinks.onUpdateQuerySucceeded), Function.createDelegate(this, myLinks.onQueryFailed));
            
                }
                
                myLinks.onUpdateQuerySucceeded = function(sender, args) {
                    alert('Links updated successfully!');
                    $('#my-links-modal').modal('hide');
                    myLinks.retrieveListItems();
                    //myLinks.retrieveListItems();
                    //myLinks.resetForm();
                }
                
                myLinks.deleteConfirm = function(id){
                    this.oListItem = myLinks.oList.getItemById(id);
                    oListItem.deleteObject();
                    this.errorMsg = "Delete list item Request failed. ";
                    myLinks.clientContext.executeQueryAsync(Function.createDelegate(this, myLinks.onDelQuerySucceeded), Function.createDelegate(this, myLinks.onQueryFailed));
                }
                
                myLinks.onDelQuerySucceeded = function() {
                    alert('Item deleted!');
                    myLinks.retrieveListItems();
                    myLinks.resetForm();
                }
                
            </script>





<script type="text/javascript">
    //my apps script.

    $('#apps-right-btn').click(function() {
        event.preventDefault();    
        $('.apps-external-div').animate({
            scrollLeft: "+=100px"
        }, "fast");
    });
        
    $('#apps-left-btn').click(function() {
        event.preventDefault();
        $('.apps-external-div').animate({
            scrollLeft: "-=100px"
        }, "fast");
    });

    /*===  variables ===*/
    var apps = {
        clientContext: null,
        oList: null,
        editMode: false,
        responseMsg: '',
        items: [], //user selected apps (my apps)
        allItems: [] //all apps, that the user can select from.
    };
    /*===  variables ===*/	

    /*===  helper functions ===*/
    apps.onQueryFailed = function(sender, args) {
        debugger;
        var customMsg = this.errorMsg? this.errorMsg : '';
        alert(customMsg + args.get_message() + '\n' + args.get_stackTrace());
    }
    /*===  helper functions ===*/

    $( document ).ready(function() {
        SP.SOD.executeFunc('sp.js', 'SP.ClientContext', function(){
                apps.getItems();
            });
    });

    apps.getItems = function(){
        apps.clientContext = new SP.ClientContext();
        apps.oList = apps.clientContext.get_web().get_lists().getByTitle('My Apps');
        var camlQuery = new SP.CamlQuery();
        //IsActive = true, Order by 'Order asc'.
        var q = "<View><Query><Where><Eq><FieldRef Name='Author' LookupId='TRUE' /><Value Type='Integer'><UserID /></Value></Eq></Where><Where>" +"<Eq>" + "<FieldRef Name='IsActive' />" + "<Value Type='Boolean'>1</Value>" + "</Eq>" + " </Where>" + "<OrderBy><FieldRef Name='Order0' Ascending='True' /></OrderBy>" + "</Query>" + "</View>";
        camlQuery.set_viewXml(q);
        apps.collListItem = apps.oList.getItems(camlQuery);
        apps.clientContext.load(apps.collListItem);
        this.errorMsg = "Get list items request failed! "; //this is available in success/error functions called below;
        apps.clientContext.executeQueryAsync(Function.createDelegate(this, apps.onGetItemsQuerySucceeded), Function.createDelegate(this, apps.onQueryFailed));  
    }

    apps.onGetItemsQuerySucceeded = function(sender, args) {
        apps.items = [];
        var listItemEnumerator = apps.collListItem.getEnumerator();	
        while (listItemEnumerator.moveNext()) {
            var oListItem = listItemEnumerator.get_current();
            var item = {
                    id: oListItem.get_item('ID'),
                    title: oListItem.get_item('AppId').get_lookupValue(),
                    order: oListItem.get_item('Order0'),
                    appId: oListItem.get_item('AppId').get_lookupId(),
                    url: oListItem.get_item('AppId_x003a_URL').get_lookupValue(),
                    icon: oListItem.get_item('AppId_x003a_Icon').get_lookupValue(),         
            };

            apps.items.push(item);
        }

        //render logic here
        var html = '';
        if(apps.items){
            for(var i = 0; i < apps.items.length; i++){
                var item = apps.items[i];
                html += '<li class="internal nav-item">'+
                        '	<a class="nav-link" href="'+ item.url +'" target="_blank"><img src="'+ item.icon +'" class="img-fluid" style="height:34px;" alt=""><br><small>'+ item.title +'</small></a>'+
                        '</li>';
            }
            if(html){
                $('.my-apps-sec div.aps-crsl').css({"display": "block"});
                $('.my-apps-sec .apps-not-found').css({"display": "none"});
                $('#my-apps-ul').empty();
                $('#my-apps-ul').append(html);
            }
            else{
                $('.my-apps-sec div.aps-crsl').css({"display": "none"});
                $('.my-apps-sec .apps-not-found').css({"display": "block"});
            }
        }
    }

    $('#add-apps').click(function(e){
        e.preventDefault();
        $('#myApps-save-btn').show();
        $('#myLinks-save-btn').hide();
        apps.clientContext = new SP.ClientContext();
        apps.oList = apps.clientContext.get_web().get_lists().getByTitle('Apps');
        var camlQuery = new SP.CamlQuery();
        var q = "<View><Query><Where>" +"<Eq>" + "<FieldRef Name='IsActive' />" + "<Value Type='Boolean'>1</Value>" + "</Eq>" + " </Where>" + "" + "</Query>" + "</View>";
        camlQuery.set_viewXml(q);
        apps.collListItem = apps.oList.getItems(camlQuery);
        apps.clientContext.load(apps.collListItem);
        this.errorMsg = "Get list items request failed! "; //this is available in success/error functions called below;
        apps.clientContext.executeQueryAsync(Function.createDelegate(this, function(sender, args){
            apps.onGetAppsQuerySucceeded(sender, args, apps.collListItem);
        }), Function.createDelegate(this, apps.onQueryFailed));  

    });

    apps.onGetAppsQuerySucceeded = function(sender, args, collListItem){
        apps.allItems = [];
        var listItemEnumerator = collListItem.getEnumerator();	
        while (listItemEnumerator.moveNext()) {
            var oListItem = listItemEnumerator.get_current();
            var item = {
                    id: oListItem.get_item('ID'),
                    title: oListItem.get_item('Title'),
                    url: oListItem.get_item('URL'),
                    icon: oListItem.get_item('Icon'),
                    order: null
      
            };
            apps.allItems.push(item);
        }

        ///////////////////////////
        $('#my-links-modal').modal('show');
        $('.nav-tabs a[href="#myApps-popuptab1"]').tab('show');
        if(apps.items){
            var html = '';
            //render my apps.
            for(var i = 0; i < 12; i++){
                var item = apps.items[i];
                if(item)
                    html += '<li class="col-sm-2 col-6" data-appid="'+ item.appId +'" data-exists="true">'+
                            '	<a href="" class="drag">'+
                            '		<span><img src="'+ item.icon +'" alt="">'+
                            '		<br>'+ item.title +
                            '		</span>'+
                            '	</a>'+
                            '</li>';
            }
            //if(html){
                //render my apps
                $('#my-draggable').empty(); 
                $('#my-draggable').append(html);        
                $("#my-draggable").sortable({
                    update: function(event, ui){
                        myAppsSortHandler(event, ui);
                    }
                });

            //}

            //render all apps
            if(apps.allItems){
                var html = '';
                for(var i = 0; i < apps.allItems.length; i++){
                    var item = apps.allItems[i];
                    //check if it is present in 'my apps'.
                    var exists = $.grep(apps.items, function(i) {
                        return i.appId == item.id;
                    });

                    html += '<li title="'+ (exists && exists.length ? 'You have already added this app!': '') +'" class="col-sm-2 col-6 '+  (exists && exists.length ? 'unsortable': 'soortable')+'" data-appid="'+ item.id +'">'+
                            '	<a href="" class="drag">'+
                            '		<span><img src="'+ item.icon +'" alt="">'+
                            '		<br>'+ item.title +
                            '		</span>'+
                            '	</a>'+
                            '</li>';
                }
                if(html){
                    $('#all-draggable').empty().append(html);
                    $("#all-draggable").sortable({
                        items: "li:not(.unsortable)",
                        connectWith: '#my-draggable',
                    });
                    $("#all-draggable").disableSelection();
                }
            }
        }


        //////////////////////////

    }

    var myAppsSortHandler = function(event, ui){
        //debugger;
        //called whenever sorting order is changed.
    }

    $('#myApps-save-btn').click(function(){
        var newApps = [], updatedApps = [];

        //deep copy.
        var myApps = JSON.parse(JSON.stringify(apps.items));
        var allApps = JSON.parse(JSON.stringify(apps.allItems));


        var myAppsLi = $("#my-draggable li");
        myAppsLi.each(function(idx, li) {

            var appId = $(this).attr('data-appid'); 
            var exists = $(this).attr('data-exists');
            var order = idx + 1;

            if(appId){
                //first check newly added items.
                if(!exists){
                    var found = $.grep(allApps, function(i) {
                        return i.id == appId;
                    });
                    if(found && found.length){
                        var item = found[0];
                        item.order = order;                  
                        newApps.push(item);
                    }
                }
                else{
                    //check if existing item needs to be updated.
                    var found = $.grep(myApps, function(i) {
                        return i.appId == appId;
                    });
                    if(found && found.length){
                        var item = found[0];
                        //check if item order has changed. for now, we only update existing item if order is changed.
                        if(item.order != order){
                            item.order = order;
                            updatedApps.push(item);
                        }
                    }
                }
            }
        });

        debugger;   

        if(newApps.length || updatedApps.length){
            $('#myApps-save-btn').attr('disabled','disabled');
            apps.clientContext = new SP.ClientContext();
            apps.oList = apps.clientContext.get_web().get_lists().getByTitle('My Apps');
        }


        if(newApps.length){          
            for(var i = 0; i < newApps.length; i++){
                
                var item = newApps[i];
                var itemCreateInfo = new SP.ListItemCreationInformation();
                apps.oListItem = apps.oList.addItem(itemCreateInfo);
                apps.oListItem.set_item('AppId', item.id);
                apps.oListItem.set_item('Order0', item.order);
                apps.oListItem.set_item('IsActive', "Yes");
                apps.oListItem.update();
                apps.clientContext.load(apps.oListItem);
                this.errorMsg = "Create list item Request failed. ";
            }
            apps.clientContext.executeQueryAsync(Function.createDelegate(this, function(sender, args){

                updateApps();

            }), Function.createDelegate(this, apps.onQueryFailed));
            
        }
        else{
            //only update case applies.
            updateApps();
        }


        function updateApps(){
            if(updatedApps.length){
                    for(var i = 0; i < updatedApps.length; i++){
                        var item = updatedApps[i];
                        apps.oListItem = apps.oList.getItemById(item.id);
                        apps.oListItem.set_item('Order0', item.order);
                        apps.oListItem.update();
                    }
                    apps.clientContext.executeQueryAsync(Function.createDelegate(this, function(sender, args){
                        
                        hideAppsModal();

                    }), Function.createDelegate(this, apps.onQueryFailed));
                }
                else{
                    hideAppsModal();
                }
        }

        function hideAppsModal(){
            $('#my-links-modal').modal('hide');
            $('#myApps-save-btn').removeAttr('disabled');
            apps.getItems();
        }

    });



    $('.nav-tabs a[href="#myLinks-popuptab2"]').click(function(){
        $('#myApps-save-btn').hide();
        $('#myLinks-save-btn').show();
    });
    $('.nav-tabs a[href="#myApps-popuptab1"]').click(function(){
        $('#myApps-save-btn').show();
        $('#myLinks-save-btn').hide();
    });

</script>