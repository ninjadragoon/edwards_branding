<!-- edwards channel --> 

<style>
 .edwards-channel-sec .fa-play-circle{
    font-size: 70px;
 }
 .edwards-channel-sec a.video-play-btn{
    color: #1f2123;
    position: absolute;
    left: 50%;
    top: 50%;
    margin-left: -35px;
    margin-top: -35px;
    cursor: pointer;
    -moz-transition: all .2s ease-in;
    -o-transition: all .2s ease-in;
    -webkit-transition: all .2s ease-in;
    transition: all .2s ease-in;
 }
 .edwards-channel-sec a.video-play-btn:hover{
     color: #c8102e;
     top: 51%;
 }
 .edwards-channel-sec .embed-responsive.mb-2,  .edwards-channel-sec .embed-responsive.mb-4{
    background-position: center;
    background-size: cover;
    background-repeat: no-repeat;
    border: 1px solid #4c5156;
 }

</style>

<div class="row">
    <div class="edwards-channel-sec bg-dark col-lg-6 p-3 py-5 p-xl-5">
        <h4 class="text-uppercase font-weight-bold ls-1 text-white edwards-brdr no-gry mb-3">edwards channel</h4>
        <div class="d-none d-lg-block edwards-videos">
            <div class="embed-responsive embed-responsive-16by9 mb-4">
                <a class="video-play-btn" href="#" target="_blank"><i class="fas fa-play-circle"></i></a>
                <div class="position-absolute bl-0 text-white mx-auto px-3 mb-3">-</div>
            </div>
            <div class="row">
                <div class="col">
                    <div class="embed-responsive embed-responsive-16by9 mb-2">
                        <a class="video-play-btn" href="#" target="_blank"><i class="fas fa-play-circle"></i></a>
                    </div>
                    <b class="text-white">-</b>
                </div>
                <div class="col">
                    <div class="embed-responsive embed-responsive-16by9 mb-2">
                        <a class="video-play-btn" href="#" target="_blank"><i class="fas fa-play-circle"></i></a>
                    </div>
                    <b class="text-white">-</b>
                </div>
                <div class="col">
                    <div class="embed-responsive embed-responsive-16by9 mb-2">
                        <a class="video-play-btn" href="#" target="_blank"><i class="fas fa-play-circle"></i></a>
                    </div>
                    <b class="text-white">-</b>
                </div>
            </div>
        </div>

        <div class="edwards-mbl-carousel d-block d-lg-none">
            <div id="carouselExampleIndicators01" class="carousel slide" data-ride="carousel" data-interval="false">
                <div class="carousel-inner">
                  <div class="carousel-item active">
                        <div class="embed-responsive embed-responsive-16by9 mb-4">
                            <a class="video-play-btn" href="#" target="_blank"><i class="fas fa-play-circle"></i></a>
                            <div class="position-absolute bl-0 text-white mx-auto px-3 mb-3">-</div>
                        </div>
                  </div>
                  <div class="carousel-item">
                        <div class="embed-responsive embed-responsive-16by9 mb-4">
                            <a class="video-play-btn" href="#" target="_blank"><i class="fas fa-play-circle"></i></a>
                            <div class="position-absolute bl-0 text-white mx-auto px-3 mb-3">-</div>
                        </div>
                  </div>
                  <div class="carousel-item">
                        <div class="embed-responsive embed-responsive-16by9 mb-4">
                            <a class="video-play-btn" href="#" target="_blank"><i class="fas fa-play-circle"></i></a>
                            <div class="position-absolute bl-0 text-white mx-auto px-3 mb-3">-</div>
                        </div>
                  </div>
                  <div class="carousel-item">
                        <div class="embed-responsive embed-responsive-16by9 mb-4">
                            <a class="video-play-btn" href="#" target="_blank"><i class="fas fa-play-circle"></i></a>
                            <div class="position-absolute bl-0 text-white mx-auto px-3 mb-3">-</div>
                        </div>
                  </div>
                </div>
                <ol class="carousel-indicators position-static">
                    <li data-target="#carouselExampleIndicators01" data-slide-to="0" class="active"></li>
                    <li data-target="#carouselExampleIndicators01" data-slide-to="1" class=""></li>
                    <li data-target="#carouselExampleIndicators01" data-slide-to="2" class=""></li>
                    <li data-target="#carouselExampleIndicators01" data-slide-to="3" class=""></li>
                </ol>
            </div>
        </div>

    </div>
    <div class="edwards-resources-sec bg-primary col-lg-6 p-3 py-5 p-xl-5">
        <h4 class="text-uppercase font-weight-bold ls-1 text-white edwards-brdr no-gry mb-3">key resources</h4>
        <div class="row mb-4">
            <div class="col-6">
                <figure class="figure mnu-fgr rsrcs w-100 m-0 border">
                  <a href="#" class=" banner d-block text-center" style="background-image: url(/_catalogs/masterpage/OneEdwards/images/benefits.jpg);">
                  <figcaption class="figure-caption">Benefits &amp; Wellness</figcaption></a>
                </figure>
            </div>
            <div class="col-6">
                <figure class="figure mnu-fgr rsrcs w-100 m-0 border">
                  <a href="#" class=" banner d-block text-center" style="background-image: url(/_catalogs/masterpage/OneEdwards/images/hr.jpg);">
                  <figcaption class="figure-caption">My HR</figcaption></a>
                </figure>
            </div>
        </div>
        <div class="row mb-4">
            <div class="col-6">
                <figure class="figure mnu-fgr rsrcs w-100 m-0 border">
                  <a href="#" class=" banner d-block text-center" style="background-image: url(/_catalogs/masterpage/OneEdwards/images/banner01.jpg);">
                  <figcaption class="figure-caption">News Releases</figcaption></a>
                </figure>
            </div>
            <div class="col-6">
                <figure class="figure mnu-fgr rsrcs w-100 m-0 border">
                  <a href="#" class=" banner d-block text-center" style="background-image: url(/_catalogs/masterpage/OneEdwards/images/stats.png);">
                  <figcaption class="figure-caption">Usage Stats</figcaption></a>
                </figure>
            </div>
        </div>
        <div class="row mb-4">
            <div class="col-6">
                <figure class="figure mnu-fgr rsrcs w-100 m-0 border">
                  <a href="#" class=" banner d-block text-center" style="background-image: url(/_catalogs/masterpage/OneEdwards/images/travel_policy.png);">
                  <figcaption class="figure-caption">Travel Policies</figcaption></a>
                </figure>
            </div>
            <div class="col-6">
                <figure class="figure mnu-fgr rsrcs w-100 m-0 border">
                  <a href="#" class=" banner d-block text-center" style="background-image: url(/_catalogs/masterpage/OneEdwards/images/it_support.jpg);">
                  <figcaption class="figure-caption">IT Requests</figcaption></a>
                </figure>
            </div>
        </div>
    </div>
</div>
<!-- end edwards channel -->â€‹


<script>
/*===  variables ===*/
var youtube = {
    clientContext: null,
    oList: null,
    editMode: false,
    responseMsg: '',
    items: []
};
/*===  variables ===*/	

/*===  helper functions ===*/
youtube.onQueryFailed = function(sender, args) {
    debugger;
    var customMsg = this.errorMsg? this.errorMsg : '';
    alert(customMsg + args.get_message() + '\n' + args.get_stackTrace());
}
/*===  helper functions ===*/

$( document ).ready(function() {
    SP.SOD.executeFunc('sp.js', 'SP.ClientContext', function(){
            youtube.getItems();
        });
});

youtube.getItems = function(){    
    youtube.clientContext = new SP.ClientContext();
    youtube.oList = youtube.clientContext.get_web().get_lists().getByTitle('Edwards Channel');
    var camlQuery = new SP.CamlQuery();
    //IsActive = true, Order by 'Order asc'.
    var q = "<View><Query><Where>" +"<Eq>" + "<FieldRef Name='IsActive' />" + "<Value Type='Boolean'>1</Value>" + "</Eq>" + " </Where>" + "<OrderBy><FieldRef Name='Order0' Ascending='True' /></OrderBy>" + "</Query>" + "</View>";
    camlQuery.set_viewXml(q);
    youtube.collListItem = youtube.oList.getItems(camlQuery);
    youtube.clientContext.load(youtube.collListItem);
    this.errorMsg = "Get list items request failed! "; //this is available in success/error functions called below;
    // youtube.clientContext.executeQueryAsync(Function.createDelegate(this, youtube.onGetItemsQuerySucceeded), Function.createDelegate(this, youtube.onQueryFailed));  
    youtube.clientContext.executeQueryAsync(youtube.onGetItemsQuerySucceeded);  

}

youtube.onGetItemsQuerySucceeded = function(sender, args) {
    youtube.items = [];
    var listItemEnumerator = youtube.collListItem.getEnumerator();	
    while (listItemEnumerator.moveNext()) {
        var oListItem = listItemEnumerator.get_current();
        var item = {
                id: oListItem.get_item('ID'),
                title: oListItem.get_item('Title'),
                order: oListItem.get_item('Order0'),
                url: oListItem.get_item('URL_Test')
        };

        //if you have to make ajax calls in a loop, you have to follow below approach. 
        (function(){
            var listItemId = item.id;
            var attachmentFiles = null;
            attachmentFiles = oListItem.get_attachmentFiles();
            youtube.clientContext.load(attachmentFiles);
            youtube.clientContext.executeQueryAsync(function () {
                if(attachmentFiles.get_count() > 0){
                    var attachmentsItemsEnumerator = attachmentFiles.getEnumerator();
                    while (attachmentsItemsEnumerator.moveNext()) {
                        var attachitem = attachmentsItemsEnumerator.get_current(); 
                        var attachTitle = attachitem.get_fileName();
                        var attachUrl = attachitem.get_serverRelativeUrl();//relative url
                        for (var i = 0; i < youtube.items.length; i++) {
                                var yt = youtube.items[i];
                                if(yt.id == listItemId){
                                    yt.thumbnail = attachUrl;
                                }
                        }
                    }
                }
            }, function(){
                console.log('an error occured while getting youtube channel attachments.');
            });
        })();
        
        youtube.items.push(item);
    }	

    if(youtube.items.length){
        $('.edwards-channel-sec .edwards-videos .embed-responsive.mb-4 a.video-play-btn').attr('href', youtube.items[0].url);
        $('.edwards-channel-sec .edwards-videos .embed-responsive.mb-4 .text-white').text(youtube.items[0].title);

        $('.edwards-channel-sec .embed-responsive.mb-2').each(function(i, obj) {
            if(youtube.items[i + 1]){
                $(this).find(".video-play-btn").attr('href', youtube.items[i+1].url);
                $(this).siblings('.text-white').text(youtube.items[i+1].title);
            }
        });

        //apply video thumbnails
        var domain = "https://edwardslifesciences.sharepoint.com";
        setTimeout(function(){ 
            if(youtube.items.length){
                if(youtube.items[0].thumbnail){
                    var img = domain + youtube.items[0].thumbnail;
                    $('.edwards-channel-sec .edwards-videos .embed-responsive.mb-4').css('background-image', "url('"+ img +"')" );
                }
                $('.edwards-channel-sec .embed-responsive.mb-2').each(function(i, obj) {
                    if(youtube.items[i + 1] && youtube.items[i + 1].thumbnail){
                        var img = domain + youtube.items[i + 1].thumbnail;
                        $(this).css('background-image', "url('"+ img +"')" );
                    }
                });            
            }
            //all items go in the carousel.
            $('.edwards-channel-sec .edwards-mbl-carousel .carousel-item').each(function(i, obj) {
                if(youtube.items[i]){
                    $(this).find("video-play-btn").attr('href', youtube.items[i].url);
                    $(this).find('.text-white').text(youtube.items[i].title);
                    if(youtube.items[i].thumbnail){
                        var img = domain + youtube.items[i].thumbnail;
                        $(this).find('.embed-responsive.mb-4').css('background-image', "url('"+ img +"')" );
                    }
                }
            });
        }, 2000);
    }
}



</script>
