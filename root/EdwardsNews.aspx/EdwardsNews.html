<style>
    #edwards-news-03082019 .glbl-strs .card small{
        font-weight: bold;
    }
    #edwards-news-03082019 .glbl-strs .card h6{
        font-size: 90%;
        margin-top: 10px;
    }
    #edwards-news-03082019 .card.ptnt-crd h4{
        color: white;
    }
    @media (max-width: 400px){
        
    }
</style>


<div id="edwards-news-03082019">
        <div class="nws-tbs-sec row px-xl-5 py-xl-2 p-3 bg-light">
                <div class=" col p-0 edwrds-nws-tbs">
                   <ul class="nav nav-tabs justify-content-center border-0" id="edwrds-nws-tab" role="tablist">
                      <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#global-news" role="tab"><h5 class="m-0 font-weight-bold"><i class="fas fa-globe fa-2x pb-2"></i><br>Global News</h5></a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#regional-news" role="tab"><h5 class="m-0 font-weight-bold"><i class="fas fa-map-marker-alt fa-2x pb-2"></i><br>Regional News</h5></a>
                      </li>
                    </ul>
               </div>
        </div>
        
        
        <div class="row no-gutters tab-content nws-tbs-cntnt" id="rgnl-tb-Content">
            <div class="col-lg-12 tab-pane fade show active" id="global-news" role="tabpanel">
                <div class="glbl-strs row px-xl-5 py-xl-4 p-3">
                    <div class="col p-0">
                        <h5 class="font-weight-bold text-dark edwards-brdr mb-4">Global Top Stories</h5>
                        <a href="#" class="text-primary position-absolute tr-0 mt-2"><small>View all</small></a>
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="card-deck offc-365 mb-4" id="global-top-r1">                                                                                                                                                    
                                    <!-- card row 1 -->
                                </div>
                                <div class="card-deck offc-365 mb-3" id="global-top-r2">
                                    <!-- card row 2 -->                                                                                       
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <ul id="global-top-side" class="list-group list-group-flush lst-with-brdr bg-light p-3">
                                    <!-- list items -->
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="glbl-nws-hdng-bx row px-xl-5 py-xl-4 p-3 bg-light">
                    <div class="col p-0">
                        <div class="text-right mb-lg-3">
                            <a href="#" class=" text-primary d-none d-lg-inline "><small>View all</small></a>
                        </div>
                        <div class="row">
                            <div class="col-lg-4 mb-lg-0 mb-3">
                                <div class="card ptnt-crd border-0 text-white bg-dark rounded-0 h-100">
                                  <div class="card-body p-4">
                                    <h4 class="card-title text-uppercase edwards-brdr no-gry ls-1 mb-4">Patient<br> First</h4>
                                    <p class="card-text">Description text about patient first series goes here.</p>
                                  </div>
                                </div>
                            </div>
                            <div class="col-lg-4" id="global-patient-1">
                                <!-- news go here -->
                            </div>
                            <div class="col-lg-4" id="global-patient-2">
                                <!-- news go here -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="glbl-nws-hdng-bx row px-xl-5 py-xl-4 p-3">
                    <div class="col p-0">
                        <div class="text-right mb-lg-3">
                            <a href="#" class=" text-primary d-none d-lg-inline "><small>View all</small></a>
                        </div>
                        <div class="row">
                            <div class="col-lg-4 mb-lg-0 mb-3">
                                <div class="card ptnt-crd border-0 text-white bg-crnbry rounded-0 h-100">
                                  <div class="card-body p-4">
                                    <h4 class="card-title text-uppercase edwards-brdr no-gry ls-1 mb-4">Strengthen our community</h4>
                                    <p class="card-text">Description text about patient first series goes here.</p>
                                  </div>
                                </div>
                            </div>
                            <div class="col-lg-4" id="global-community-1">
                                <!-- news go here -->
                            </div>
                            <div class="col-lg-4" id="global-community-2">
                                <!-- news go here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-12 tab-pane fade" id="regional-news" role="tabpanel">
                <div class="glbl-strs row px-xl-5 py-xl-4 p-3">
                    <div class="col p-0">
                        <h5 class="font-weight-bold text-dark edwards-brdr mb-4">Regional Top Stories</h5>
                        <a href="#" class="text-primary position-absolute tr-0 mt-2"><small>View all</small></a>
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="card-deck offc-365 mb-4" id="regional-top-r1">                                                                      
                                       
                                </div>
                                <div class="card-deck offc-365 mb-3" id="regional-top-r2">                                                                      
                                
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <ul class="list-group list-group-flush lst-with-brdr bg-light p-3" id="regional-top-side">
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="glbl-nws-hdng-bx row px-xl-5 py-xl-4 p-3 bg-light">
                    <div class="col p-0">
                        <div class="text-right mb-lg-3">
                            <a href="#" class=" text-primary d-none d-lg-inline "><small>View all</small></a>
                        </div>
                        <div class="row">
                            <div class="col-lg-4 mb-lg-0 mb-3">
                                <div class="card ptnt-crd border-0 text-white bg-dark rounded-0 h-100">
                                  <div class="card-body p-4">
                                    <h4 class="card-title text-uppercase edwards-brdr no-gry ls-1 mb-4">Hot <br>Topics</h4>
                                    <p class="card-text">Description text about patient first series goes here.</p>
                                  </div>
                                </div>
                            </div>
                            <div class="col-lg-4" id="regional-patient-1">
                                
                            </div>
                            <div class="col-lg-4" id="regional-patient-2">
                                
                            </div>
                        </div>
                    </div>
                </div>
                <div class="glbl-nws-hdng-bx row px-xl-5 py-xl-4 p-3">
                    <div class="col p-0">
                        <div class="text-right mb-lg-3">
                            <a href="#" class=" text-primary d-none d-lg-inline "><small>View all</small></a>
                        </div>
                        <div class="row">
                            <div class="col-lg-4 mb-lg-0 mb-3">
                                <div class="card ptnt-crd border-0 text-white bg-crnbry rounded-0 h-100">
                                  <div class="card-body p-4">
                                    <h4 class="card-title text-uppercase edwards-brdr no-gry ls-1 mb-4">Employee <br> News</h4>
                                    <p class="card-text">Description text about patient first series goes here.</p>
                                  </div>
                                </div>
                            </div>
                            <div class="col-lg-4" id="regional-community-1">
                                
                            </div>
                            <div class="col-lg-4" id="regional-community-2">
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
</div>


<script>

/*===  variables aaa===*/
var edwardsNews = {
    global: {
        top: [],
        patient: [],
        strength: []
    },
    regional: {
        top: [],
        hot: [],
        employee: []
    },
    newsType: ['Global', 'Regional'],
    newsCategories:{
        global: ['Global Top Stories', 'Patient First', 'Strengthen Our Community'],
        regional: ['Regional Top Stories', 'Hot Topics', 'Employee News']
    }
};
/*===  variables ===*/	

/*===  helper functions ===*/
edwardsNews.onQueryFailed = function(sender, args) {
    debugger;
    var customMsg = this.errorMsg? this.errorMsg : '';
    alert(customMsg + args.get_message() + '\n' + args.get_stackTrace());
}

edwardsNews.getUrlParameter = function getUrlParameter(sParam) {
    var sPageURL = window.location.search.substring(1),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
        }
    }
};

edwardsNews.truncateText = function(text, tLength){
    if(!text)
        return "";
    else if(text.length > tLength)
        return text.substring(0, tLength) + '...';
    else
        return text;
}

/*===  helper functions ===*/

$( document ).ready(function() {
    SP.SOD.executeFunc('sp.js', 'SP.ClientContext', function(){
        var newsType = edwardsNews.getUrlParameter('type');
        if(newsType){
            if(newsType == "regional"){
                $('[href="#regional-news"]').tab('show');
                //news type, all news categories.
                // edwardsNews.getGlobal(edwardsNews.newsType[1], edwardsNews.newsCategories.regional);
            }
            else{
                $('[href="#global-news"]').tab('show');
                // edwardsNews.getGlobal(edwardsNews.newsType[0], edwardsNews.newsCategories.global);
            }

         } 
         edwardsNews.getGlobal(edwardsNews.newsType[1], edwardsNews.newsCategories.regional);  
         edwardsNews.getGlobal(edwardsNews.newsType[0], edwardsNews.newsCategories.global);
    });
});

edwardsNews.getGlobal = function(type, categories){
    for(var i=0; i< categories.length; i++){
        var cat = categories[i];
        var rowLimit = 4;
        if(i == 0) 
            rowLimit = 12;
        
        //1. type
        //2. category
        //3. row limit
        edwardsNews.getNews(type, cat, rowLimit);
    }
}

edwardsNews.getNews = function(type, cat, limit){
        
        var clientContext = new SP.ClientContext();
        var oList = clientContext.get_web().get_lists().getByTitle('News');
        var camlQuery = new SP.CamlQuery();
        //where isActive = 1 and type = 'global' and category = 'global top stories' limit x order by order0 asc
        var q = '';

        if(type == edwardsNews.newsType[0])
            q = "<View><Query><Where><And>" +"<Eq>" + "<FieldRef Name='IsActive' />" + "<Value Type='Boolean'>1</Value>" + "</Eq><And>" + "<Eq><FieldRef Name='News_x0020_Type'/><Value Type='Choice'>" + type + "</Value></Eq>" + "<Eq><FieldRef Name='Global_x0020_News_x0020_Categori'/><Value Type='Choice'>" + cat + "</Value></Eq>" + "</And></And> </Where>" + "<OrderBy><FieldRef Name='Order0' Ascending='True' /></OrderBy>" + "</Query><RowLimit>" + limit + "</RowLimit></View>";
        else if(type == edwardsNews.newsType[1])
            q = "<View><Query><Where><And>" +"<Eq>" + "<FieldRef Name='IsActive' />" + "<Value Type='Boolean'>1</Value>" + "</Eq><And>" + "<Eq><FieldRef Name='News_x0020_Type'/><Value Type='Choice'>" + type + "</Value></Eq>" + "<Eq><FieldRef Name='Regional_x0020_News_x0020_Catego'/><Value Type='Choice'>" + cat + "</Value></Eq>" + "</And></And> </Where>" + "<OrderBy><FieldRef Name='Order0' Ascending='True' /></OrderBy>" + "</Query><RowLimit>" + limit + "</RowLimit></View>";

        camlQuery.set_viewXml(q);
        var collListItem = oList.getItems(camlQuery);
        clientContext.load(collListItem);
        this.errorMsg = "Get list items request failed! "; //this is available in success/error functions called below;
        
        clientContext.executeQueryAsync(
            Function.createDelegate(this, function(sender, args){
                
                var listItemEnumerator = collListItem.getEnumerator();	
                while (listItemEnumerator.moveNext()) {
                    var oListItem = listItemEnumerator.get_current();
                    var item = {
                            id: oListItem.get_item('ID'),
                            title: edwardsNews.truncateText(oListItem.get_item('Title'), 50),
                            carouselDescription: edwardsNews.truncateText(oListItem.get_item('Description'), 70),
                            taxKeyword: oListItem.get_item('Tag'),
                            carouselImage: oListItem.get_item('ImageUrl') ? oListItem.get_item('ImageUrl').get_url(): '',
                            carouselOrder: oListItem.get_item('Order0'),
                            pageUrl: oListItem.get_item('Url')
                    };
                    //push data into global
                    if(type == edwardsNews.newsType[0]){
                        if(cat == edwardsNews.newsCategories.global[0])
                            edwardsNews.global.top.push(item);
                        if(cat == edwardsNews.newsCategories.global[1])
                            edwardsNews.global.patient.push(item);
                        if(cat == edwardsNews.newsCategories.global[2])
                            edwardsNews.global.strength.push(item);
                    }  
                    //push data into regional ffff
                    if(type == edwardsNews.newsType[1]){
                        if(cat == edwardsNews.newsCategories.regional[0])
                            edwardsNews.regional.top.push(item);
                        if(cat == edwardsNews.newsCategories.regional[1])
                            edwardsNews.regional.hot.push(item);
                        if(cat == edwardsNews.newsCategories.regional[2])
                            edwardsNews.regional.employee.push(item);
                    }    
                }

                //render logic here.
                //if(type == edwardsNews.newsType[0]){
                    //global top OR regional top.
                    if(cat == edwardsNews.newsCategories.global[0] || cat == edwardsNews.newsCategories.regional[0]) {
                        edwardsNews.renderGlobalTopStories(type);
                    }
                    else if(cat == edwardsNews.newsCategories.global[1]){
                        //col1 id, col2 id, news type, news category
                        edwardsNews.renderGlobalPatient('#global-patient-1', '#global-patient-2', type, cat);
                    }
                    else if(cat == edwardsNews.newsCategories.global[2]){
                        //col1 id, col2 id, news type, news category
                        edwardsNews.renderGlobalPatient('#global-community-1', '#global-community-2', type, cat);
                    }
                    else if(cat == edwardsNews.newsCategories.regional[1]){
                        //col1 id, col2 id, news type, news category
                        edwardsNews.renderGlobalPatient('#regional-patient-1', '#regional-patient-2', type, cat);
                    }
                    else if(cat == edwardsNews.newsCategories.regional[2]){
                        //col1 id, col2 id, news type, news category
                        edwardsNews.renderGlobalPatient('#regional-community-1', '#regional-community-2', type, cat);
                    }
                //}


            }),
            Function.createDelegate(this, edwardsNews.onQueryFailed));  
}


edwardsNews.renderGlobalTopStories = function(type){
    var row1 = '', row2 = '', sidebar = '';
    var row1Id = '', row2Id = '', sidebarId = '';
    var items = [];
    if(type == edwardsNews.newsType[0]){
        row1Id = '#global-top-r1';
        row2Id = '#global-top-r2';
        sidebarId = '#global-top-side';
        items = edwardsNews.global.top;
    }
    else if(type == edwardsNews.newsType[1]){
        row1Id = '#regional-top-r1';
        row2Id = '#regional-top-r2';
        sidebarId = '#regional-top-side';
        items = edwardsNews.regional.top;
    }

    for(var i=0; i< items.length; i++){
        var item = items[i];
        var card = '<div class="card">'+
                    '	<figure class="figure mnu-fgr w-100 m-0">'+
                    '	  <a href="'+ (item.pageUrl? item.pageUrl.$1_1 : '#') +'" target="_blank" class=" banner d-block text-center" style="background-image: url(' + (item.carouselImage ? item.carouselImage : "/_catalogs/masterpage/OneEdwards/images/image-not-available.jpg") + ');">'+
                    '	  </a>'+
                    '	</figure>'+
                    '	<div class="card-body p-2">'+
                    '	<p class="text-primary mb-0"><small>'+ item.title +'</small></p>'+
                    '	  <h6 class="card-title font-weight-bold mb-0">'+ item.carouselDescription +'</h6>'+
                    '	</div>'+
                    ' </div>';

        var sideLi = '<li class="list-group-item">'+
                        '	<a href="'+ (item.pageUrl? item.pageUrl.$1_1 : '#') +'" target="_blank" class="font-weight-bold">'+
                        '		<p class="text-primary mb-0"><small>'+ item.title +'</small></p>'+
                                item.carouselDescription +
                        '	</a>'+
                        '</li>';

        if(i < 3)
            row1 += card;
        else if(i >= 3 && i < 6)
            row2 += card;
        else if(i >= 6 && i < 12)
            sidebar += sideLi;
    }
    if(row1)
       $(row1Id).append(row1); 
    if(row2)
       $(row2Id).append(row2); 
    if(sidebar)
        $(sidebarId).append(sidebar); 

}

edwardsNews.renderGlobalPatient = function(col1_id, col2_id, type, cat){
    var html = '', col1 = '', col2 = '';
    var items = [];
    if(type == edwardsNews.newsType[0]){
        //patients first
        if(cat == edwardsNews.newsCategories.global[1]){
            items = edwardsNews.global.patient;
        }
        //strengthen our comm.
        else if(cat == edwardsNews.newsCategories.global[2]){
            items = edwardsNews.global.strength;
        }
    }
    if(type == edwardsNews.newsType[1]){
        //hot topics
        if(cat == edwardsNews.newsCategories.regional[1]){
            items = edwardsNews.regional.hot;
        }
        //employee news
        else if(cat == edwardsNews.newsCategories.regional[2]){
            items = edwardsNews.regional.employee;
        }
    }

    $(col1_id).empty();
    $(col2_id).empty();

    for(var i=0; i < items.length; i++){
        var item = items[i];
        html = edwardsNews.getItemHtml(item);
        if(i < 2  && item)
            col1 += html;
        else if(i >= 2 && i < 4 && item)
            col2 += html;
    }

    if(col1)
        $(col1_id).append(col1);
    if(col2)
        $(col2_id).append(col2); 
}

edwardsNews.getItemHtml = function(item){
    return '<a href="'+ (item.pageUrl? item.pageUrl.$1_1 : '#') +'" target="_blank" class="nws-artcl media mb-4 text-muted text-decoration-none">'+
                        '	<div class="img-hldr banner mr-3 text-center" style="background-image: url(' + (item.carouselImage ? item.carouselImage : "/_catalogs/masterpage/OneEdwards/images/image-not-available.jpg") + ');">'+
                        '	</div>'+
                        '  <div class="media-body align-self-center text-dark">'+
                        '	<p class="mb-2 font-weight-bold">'+ item.title +'</p>'+
                        '	<p class="mb-0">' + item.carouselDescription + '</p>'+
                        '  </div>'+
                        '</a>';
}

</script>