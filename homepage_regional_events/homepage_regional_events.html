<div id="regional-events">
        <div class="news-headings clearfix">
                <h4>regional events</h4>
                <a href="/sites/OEBrand/Lists/Regional%20Events/calendar.aspx" target="_blank" class="clickable-anchor">view all</a>
        </div>
        <div class="row edwards-event-list-sec">
            <div class="col-3 edwards-date-sec">
                <span class="month">-</span>
                <span class="date">-</span>
            </div>
            <div class="col-9">
                <a class="cards-heading">-</a>
                <span class="chanel-desc">-</span>
            </div>
        </div>
        <div class="row edwards-event-list-sec">
            <div class="col-3 edwards-date-sec">
                <span class="month">-</span>
                <span class="date">-</span>
            </div>
            <div class="col-9">
                <a class="cards-heading">-</a>
                <span class="chanel-desc">-</span>
            </div>
        </div>
        <div class="row edwards-event-list-sec">
            <div class="col-3 edwards-date-sec">
                <span class="month">-</span>
                <span class="date">-</span>
            </div>
            <div class="col-9">
                <a class="cards-heading">-</a>
                <span class="chanel-desc">-</span>
            </div>
        </div>
        <div class="row edwards-event-list-sec">
            <div class="col-3 edwards-date-sec">
                <span class="month">-</span>
                <span class="date">-</span>
            </div>
            <div class="col-9">
                <a class="cards-heading">-</a>
                <span class="chanel-desc">-</span>
            </div>
        </div>
</div>


<script>
    /*===  variables ===*/
    var regEvents = {
		clientContext: null,
		oList: null,
		editMode: false,
		responseMsg: '',
		items: []
	};
	/*===  variables ===*/	

    /*===  helper functions ===*/
	regEvents.onQueryFailed = function(sender, args) {
		debugger;
		var customMsg = this.errorMsg? this.errorMsg : '';
		alert(customMsg + args.get_message() + '\n' + args.get_stackTrace());
	}

    /*===  visible = string('show'/'hide') ===*/
	regEvents.manageVisibility = function(visible, item){
        if(visible == 'show')
            item.css("display", "flex");
        else
            item.css("display", "none");	
	}
    /*===  helper functions ===*/

    $( document ).ready(function() {
		SP.SOD.executeFunc('sp.js', 'SP.ClientContext', function(){
            regEvents.getItems();
		});
	});

    regEvents.getItems = function(){    
        regEvents.clientContext = new SP.ClientContext();
        regEvents.oList = regEvents.clientContext.get_web().get_lists().getByTitle('Regional Events');
        var camlQuery = new SP.CamlQuery();
        //get first 4 events starting from today and onwards.
		var q = "<View><Query><Where><Geq><FieldRef Name='EventDate' /><Value Type='DateTime'> <Today  /> </Value></Geq></Where><OrderBy><FieldRef Name='EventDate' Ascending='True' /></OrderBy></Query><RowLimit>4</RowLimit></View>";
		camlQuery.set_viewXml(q);
		regEvents.collListItem = regEvents.oList.getItems(camlQuery);
		regEvents.clientContext.load(regEvents.collListItem, "Include(ID, Title, Description, EventDate, EncodedAbsUrl)");
		this.errorMsg = "Get list items request failed! "; //this is available in success/error functions called below;
		regEvents.clientContext.executeQueryAsync(Function.createDelegate(this, regEvents.onGetItemsQuerySucceeded), Function.createDelegate(this, regEvents.onQueryFailed));  
    }

    regEvents.onGetItemsQuerySucceeded = function(sender, args) {
		regEvents.items = [];
		var listItemEnumerator = regEvents.collListItem.getEnumerator();	
		while (listItemEnumerator.moveNext()) {
			var oListItem = listItemEnumerator.get_current();
			var item = {
                    id: oListItem.get_item('ID'),
                    title: oListItem.get_item('Title'),
                    description: oListItem.get_item('Description'),
                    eventDate: oListItem.get_item('EventDate'),
                    url: '/sites/OEBrand/Lists/Regional%20Events/DispForm.aspx?ID=' + oListItem.get_item('ID')
				};
                var dateAndMonth = item.eventDate.toString().slice(4, 10); //returns "Dec 13"
                item.date = dateAndMonth.split(' ')[1];
                item.month = dateAndMonth.split(' ')[0];
                regEvents.items.push(item);
		}	

        if(regEvents.items.length){
            $('#regional-events .edwards-event-list-sec').each(function(i, obj) {
                if(regEvents.items[i]){
                    $(this).find('span.date').text(regEvents.items[i].date);
                    $(this).find('span.month').text(regEvents.items[i].month);
                    $(this).find('a.cards-heading').text(regEvents.items[i].title).attr('href', regEvents.items[i].url).attr('target', '_blank');
                    if(regEvents.items[i].description){
                        //remove html tags from formatted string.
                        var formattedTxt = regEvents.items[i].description;
                        var plainTxt = $(formattedTxt).text();
                        $(this).find('span.chanel-desc').text(plainTxt);
                    }
                    else
                        $(this).find('span.chanel-desc').text('Description not available.');
                }
                else
                    regEvents.manageVisibility('hide', $(this));
            });
        }
	}



</script>
